<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IHWAP SCOUT</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 20px; }
        h1 { color: #444; }
        form { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        input[type="text"], input[type="file"] {
            padding: 10px; margin: 5px 0; width: 100%;
        }
        button {
            padding: 10px 20px; margin-top: 10px;
            background-color: #444; color: #fff; border: none;
            cursor: pointer; border-radius: 5px;
        }
        .card {
            background: #fff; padding: 15px; margin-top: 10px;
            border-left: 6px solid #444; border-radius: 6px;
        }
        .debug, .description {
            background: #eef; padding: 10px; margin-top: 10px;
            border-left: 4px solid #99f;
        }
        .scout-image {
            max-width: 100%; height: auto; border-radius: 4px;
        }
        .chat { background: #f4f4f4; padding: 10px; margin-top: 10px; border-left: 4px solid #aaa; }
    </style>
</head>
<body>
    <h1>ğŸ§  IHWAP SCOUT</h1>

    <form method="POST" enctype="multipart/form-data">
        <label>Upload a photo:</label>
        <input type="file" name="image">
        <button type="submit">Analyze Photo</button>
    </form>

    <form method="POST">
        <label>Ask Scout a question:</label>
        <input type="text" name="chat_input" placeholder="e.g. When is attic insulation deferral required?">
        <button type="submit">Ask</button>
    </form>

    {% if image_path %}
    <div>
        <h3>ğŸ“¸ Uploaded Image:</h3>
        <img src="{{ image_path }}" class="scout-image">
    </div>
    {% endif %}

    {% if result %}
        {% if result.matched_triggers %}
            {% for match in result.matched_triggers %}
                <div class="card">
                    <strong>ğŸ“Œ Trigger:</strong> {{ match.trigger }}<br><br>
                    <strong>{{ match.response.action }}</strong><br><br>
                    <strong>ğŸ“ Reason:</strong> {{ match.response.reason }}<br>
                    <strong>ğŸ”§ Recommendation:</strong> {{ match.response.recommendation }}<br>
                    <strong>ğŸ“˜ Source Policy:</strong> {{ match.response.source_policy }}<br>
                    <strong>ğŸ—‚ï¸ Category:</strong> {{ match.response.category }}<br>
                    <strong>ğŸ‘€ Visual Cue:</strong> {{ match.response.visual_cue }}<br>
                </div>
            {% endfor %}
        {% else %}
            <div class="card">
                âš ï¸ No Match Found<br>
                Scout couldnâ€™t match this image to a known condition.
            </div>
        {% endif %}

        {% if result.description %}
            <div class="description">
                <strong>ğŸ“„ Visual Description:</strong><br>
                {{ result.description }}
            </div>
        {% endif %}
    {% endif %}

    {% if chat_response %}
    <div class="chat">
        <strong>ğŸ§  Scout Chat:</strong><br>
        {{ chat_response }}
    </div>
    {% endif %}
{% if result.debug_log %}
  <div class="debug-log" style="margin-top: 20px; background-color: #eef8ee; padding: 10px; border-left: 4px solid green;">
    <h4>ğŸ› ï¸ Debug Log:</h4>
    <pre style="white-space: pre-wrap;">{{ result.debug_log }}</pre>
  </div>
{% endif %}

</body>
</html>

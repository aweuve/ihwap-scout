<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>IHWAP SCOUT</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f7f7f7; margin: 0; padding: 20px; }
        h1 { color: #444; }
        form { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        input[type="text"], input[type="file"] {
            padding: 10px; margin: 5px 0; width: 100%;
        }
        button {
            padding: 10px 20px; margin-top: 10px;
            background-color: #444; color: #fff; border: none;
            cursor: pointer; border-radius: 5px;
        }
        .card {
            background: #fff; padding: 15px; margin-top: 10px;
            border-left: 6px solid #444; border-radius: 6px;
        }
        .description, .elements, .hazards, .scout-thought {
            background: #eef; padding: 10px; margin-top: 10px;
            border-left: 4px solid #99f;
        }
        .scout-image {
            max-width: 100%; height: auto; border-radius: 4px;
        }
        .chat { background: #f4f4f4; padding: 10px; margin-top: 10px; border-left: 4px solid #aaa; }
    </style>
</head>
<body>
    <h1>🧠 IHWAP SCOUT</h1>

    <form method="POST" enctype="multipart/form-data">
        <label>Upload a photo:</label>
        <input type="file" name="image">
        <button type="submit">Analyze Photo</button>
    </form>

    <form method="POST">
        <label>Ask Scout a question:</label>
        <input type="text" name="chat_input" placeholder="e.g. When is attic insulation deferral required?">
        <button type="submit">Ask</button>
    </form>

    {% if image_path %}
    <div>
        <h3>📸 Uploaded Image:</h3>
        <img src="{{ image_path }}" class="scout-image">
    </div>
    {% endif %}

    {% if result %}
        {% if result.matched_triggers %}
            {% for match in result.matched_triggers %}
                <div class="card">
                    <strong>📌 Trigger:</strong> {{ match.trigger }}<br><br>
                    <strong>{{ match.response.action }}</strong><br><br>
                    <strong>📝 Reason:</strong> {{ match.response.reason }}<br>
                    <strong>🔧 Recommendation:</strong> {{ match.response.recommendation }}<br>
                    <strong>📘 Source Policy:</strong> {{ match.response.source_policy }}<br>
                    <strong>🗂️ Category:</strong> {{ match.response.category }}<br>
                    <strong>👀 Visual Cue:</strong> {{ match.response.visual_cue }}<br>
                </div>
            {% endfor %}
        {% endif %}

        {% if result.visible_elements %}
            <div class="elements">
                <strong>🔍 Visible Elements:</strong><br>
                {{ result.visible_elements | join(", ") }}
            </div>
        {% endif %}

        {% if result.hazards %}
            <div class="hazards">
                <strong>⚠️ Hazards Detected:</strong><br>
                {{ result.hazards | join(", ") }}
            </div>
        {% endif %}

        {% if result.scout_thought %}
            <div class="scout-thought">
                <strong>💭 Scout’s Thought:</strong><br>
                {{ result.scout_thought }}
            </div>
        {% endif %}

        {% if result.description %}
            <div class="description">
                <strong>📄 Visual Description:</strong><br>
                {{ result.description }}
            </div>
        {% endif %}
    {% endif %}

    {% if chat_response %}
    <div class="chat">
        <strong>🧠 Scout Chat:</strong><br>
        {{ chat_response }}
    </div>
    {% endif %}

    {% if result.debug_log %}
      <div class="debug-log" style="margin-top: 20px; background-color: #eef8ee; padding: 10px; border-left: 4px solid green;">
        <h4>🛠️ Debug Log:</h4>
        <pre style="white-space: pre-wrap;">{{ result.debug_log }}</pre>
      </div>
    {% endif %}

</body>
</html>

<!-- index.html: Basic Chat Thread Support -->
<!DOCTYPE html>
<html>
<head>
    <title>IHWAP SCOUT</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f7f9fb; }
        .chat-box { margin-top: 20px; border-left: 4px solid #999; padding: 10px 20px; background: white; border-radius: 6px; }
        .chat-entry { margin-bottom: 15px; }
        .chat-entry .user { font-weight: bold; color: #1a73e8; }
        .chat-entry .scout { font-weight: bold; color: #d63384; }
        .chat-entry p { margin: 4px 0; }
        .upload-area, .chat-area { margin-bottom: 20px; }
        button { margin-top: 5px; }
    </style>
</head>
<body>
    <h1>🧠 IHWAP SCOUT</h1>

    <form method="POST" enctype="multipart/form-data">
        <div class="upload-area">
            <input type="file" name="image">
            <button type="submit">Analyze Photo</button>
        </div>
        <div class="chat-area">
            <input type="text" name="chat_input" placeholder="Ask Scout a question..." style="width: 80%;">
            <button type="submit">Ask</button>
        </div>
    </form>

    {% if result %}
    <div class="chat-box">
        <strong>📸 Image Analysis</strong>
        <p><b>Description:</b> {{ result.description }}</p>
        <p><b>Visible Elements:</b> {{ result.visible_elements | join(", ") }}</p>
        <p><b>Hazards:</b> {{ result.hazards | join(", ") }}</p>
        <p><b>Scout's Thought:</b> {{ result.scout_thought }}</p>
        {% for match in result.matched_triggers %}
            <div style="margin-top: 10px;">
                <b>📌 Trigger:</b> {{ match.trigger }}<br>
                <b>⚠️ Action:</b> {{ match.response.action }}<br>
                <b>📝 Reason:</b> {{ match.response.reason }}<br>
                <b>🔧 Recommendation:</b> {{ match.response.recommendation }}<br>
                <b>📘 Citation:</b> {{ match.response.source_policy }}<br>
                <b>📂 Category:</b> {{ match.response.category }}
            </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if chat_response %}
    <div class="chat-box">
        <div class="chat-entry">
            <span class="user">You:</span>
            <p>{{ request.form['chat_input'] }}</p>
        </div>
        <div class="chat-entry">
            <span class="scout">🧠 Scout Chat:</span>
            <p>{{ chat_response }}</p>
        </div>
    </div>
    {% endif %}
</body>
</html>
